<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://ktomk.github.io/pipelines/doc/PIPELINES-HOWTO-DOCKER-CLIENT-BINARY.html rel=canonical><link rel="shortcut icon" href=../../assets/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.1.2"><title>Docker Client Binary Packages for Pipelines - Pipelines - Run Bitbucket Pipelines Wherever They Dock</title><link rel=stylesheet href=../../assets/stylesheets/main.19190aaf.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.24b84193.min.css><link rel=stylesheet href=../../assets/extra.css></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#how-to-docker-client-binary-packages-for-pipelines class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https:/ktomk.github.io/pipelines/index.html title="Pipelines - Run Bitbucket Pipelines Wherever They Dock" class="md-header-nav__button md-logo" aria-label="Pipelines - Run Bitbucket Pipelines Wherever They Dock"> <img src=../../assets/logo.svg alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Pipelines - Run Bitbucket Pipelines Wherever They Dock </span> <span class="md-header-nav__topic md-ellipsis"> Docker Client Binary Packages for Pipelines </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/ktomk/pipelines/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ktomk/pipelines </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../index.html class=md-tabs__link> Read Me </a> </li> <li class=md-tabs__item> <a href=../PIPELINES-OFFLINE.html class="md-tabs__link md-tabs__link--active"> Docs </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https:/ktomk.github.io/pipelines/index.html title="Pipelines - Run Bitbucket Pipelines Wherever They Dock" class="md-nav__button md-logo" aria-label="Pipelines - Run Bitbucket Pipelines Wherever They Dock"> <img src=../../assets/logo.svg alt=logo> </a> Pipelines - Run Bitbucket Pipelines Wherever They Dock </label> <div class=md-nav__source> <a href=https://github.com/ktomk/pipelines/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ktomk/pipelines </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Read Me <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Read Me" data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"></span> Read Me </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../index.html class=md-nav__link> Pipelines </a> </li> <li class=md-nav__item> <a href=../../CHANGELOG.html class=md-nav__link> Change Log </a> </li> <li class=md-nav__item> <a href=../../COPYING.html class=md-nav__link> Copying </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Docs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docs data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"></span> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../PIPELINES-OFFLINE.html class=md-nav__link> Working Offline </a> </li> <li class=md-nav__item> <a href=../PIPELINES-CACHES.html class=md-nav__link> Working with Pipeline Caches </a> </li> <li class=md-nav__item> <a href=../PIPELINES-SERVICES.html class=md-nav__link> Working with Pipeline Services </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Reference data-md-level=2> <label class=md-nav__title for=nav-2-4> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../PIPELINES-VARIABLE-REFERENCE.html class=md-nav__link> Pipelines Environment Variable Usage </a> </li> <li class=md-nav__item> <a href=../CONFIGURATION-PARAMETERS.html class=md-nav__link> Configuration Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5 checked> <label class=md-nav__link for=nav-2-5> How-To <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=How-To data-md-level=2> <label class=md-nav__title for=nav-2-5> <span class="md-nav__icon md-icon"></span> How-To </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Docker Client Binary Packages for Pipelines <span class="md-nav__icon md-icon"></span> </label> <a href=../PIPELINES-HOWTO-DOCKER-CLIENT-BINARY.html class="md-nav__link md-nav__link--active"> Docker Client Binary Packages for Pipelines </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> Table of Contents </a> </li> <li class=md-nav__item> <a href=#list-all-available-docker-static-binary-packages class=md-nav__link> List all Available Docker Static Binary Packages </a> </li> <li class=md-nav__item> <a href=#create-docker-client-static-binary-packages-for-pipelines class=md-nav__link> Create Docker Client Static Binary Packages for Pipelines </a> <nav class=md-nav aria-label="Create Docker Client Static Binary Packages for Pipelines"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#find-the-binary-and-download-the-release-package class=md-nav__link> Find the binary and download the release package </a> </li> <li class=md-nav__item> <a href=#obtain-meta-information class=md-nav__link> Obtain Meta-Information </a> </li> <li class=md-nav__item> <a href=#encode-meta-information-into-a-yaml-file class=md-nav__link> Encode Meta-Information into a YAML File </a> </li> <li class=md-nav__item> <a href=#add-packages-to-pipelines-project class=md-nav__link> Add Packages to Pipelines Project </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#last-but-not-least-use-a-custom-build-static-docker-client-binary class=md-nav__link> Last but not Least: Use a Custom Build Static Docker Client Binary </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../PIPELINES-HOWTO-ROOTLESS.html class=md-nav__link> Rootless Pipelines </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-6 type=checkbox id=nav-2-6> <label class=md-nav__link for=nav-2-6> Appendix <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Appendix data-md-level=2> <label class=md-nav__title for=nav-2-6> <span class="md-nav__icon md-icon"></span> Appendix </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../DEVELOPMENT.html class=md-nav__link> Utility Development </a> </li> <li class=md-nav__item> <a href=../DOCKER-NAME-TAG.html class=md-nav__link> Docker Container (Image/Tag) Name Syntax </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> Table of Contents </a> </li> <li class=md-nav__item> <a href=#list-all-available-docker-static-binary-packages class=md-nav__link> List all Available Docker Static Binary Packages </a> </li> <li class=md-nav__item> <a href=#create-docker-client-static-binary-packages-for-pipelines class=md-nav__link> Create Docker Client Static Binary Packages for Pipelines </a> <nav class=md-nav aria-label="Create Docker Client Static Binary Packages for Pipelines"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#find-the-binary-and-download-the-release-package class=md-nav__link> Find the binary and download the release package </a> </li> <li class=md-nav__item> <a href=#obtain-meta-information class=md-nav__link> Obtain Meta-Information </a> </li> <li class=md-nav__item> <a href=#encode-meta-information-into-a-yaml-file class=md-nav__link> Encode Meta-Information into a YAML File </a> </li> <li class=md-nav__item> <a href=#add-packages-to-pipelines-project class=md-nav__link> Add Packages to Pipelines Project </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#last-but-not-least-use-a-custom-build-static-docker-client-binary class=md-nav__link> Last but not Least: Use a Custom Build Static Docker Client Binary </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ktomk/pipelines/edit/master/doc/PIPELINES-HOWTO-DOCKER-CLIENT-BINARY.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=how-to-docker-client-binary-packages-for-pipelines>How-To Docker Client Binary Packages for Pipelines<a class=headerlink href=#how-to-docker-client-binary-packages-for-pipelines title="Permanent link">&para;</a></h1> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">&para;</a></h2> <p>Pipelines ships with some hard-encoded packages for a smaller number of different docker client versions including the exact same one at the time of writing that is used by Atlassian Bitbucket Cloud Pipelines Plugin.</p> <p>These packages are meta-data information on how to obtain a static binary of the Docker client and allow to use a static Docker client binary in a reproducible manner.</p> <p>Static Docker client binaries are useful for <code>pipelines</code> as they can be mounted into nearly any Linux container without further installation requirements (next to provide connectivity to the Docker daemon).</p> <p>This document is about how-to obtain the static docker client binary and all the meta-data to make use of it and also on how to create such packages next to existing packages or for improving pipelines with new package definitions.</p> <p>Be it a local <code>.yml</code> package file, a package that ships with the pipelines utility or a custom build static docker client binary.</p> <p>While doing so, this document also explains many details about the file- format of <code>.yml</code> docker client binary packages and the <code>--docker-client</code> option and arguments as well as the <code>--docker-client-pkgs</code> option.</p> <p>These options are generally useful to use a different than the default docker client.</p> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <ul> <li><a href=#list-all-available-docker-static-binary-packages>List all Available Docker Static Binary Packages</a></li> <li><a href=#create-docker-client-static-binary-packages-for-pipelines>Create Docker Client Static Binary Packages for Pipelines</a><ul> <li><a href=#find-the-binary-and-download-the-release-package>Find the Binary and Download the Release Package</a></li> <li><a href=#obtain-meta-information>Obtain Meta-Information</a></li> <li><a href=#encode-meta-information-into-a-yaml-file>Encode Meta-Information into a YAML File</a></li> <li><a href=#add-packages-to-pipelines-project>Add Packages to Pipelines Project</a></li> </ul> </li> <li><a href=#last-but-not-least-use-a-custom-build-static-docker-client-binary>Last but not Least: Use a Custom Build Static Docker Client Binary</a></li> </ul> <h2 id=list-all-available-docker-static-binary-packages>List all Available Docker Static Binary Packages<a class=headerlink href=#list-all-available-docker-static-binary-packages title="Permanent link">&para;</a></h2> <p>To display a list of all available docker client versions use the <code>--docker-client-pkgs</code> option:</p> <div class=highlight><pre><span></span><code>$ bin/pipelines --docker-client-pkgs
docker-17.12.0-ce-linux-static-x86_64
docker-18.09.1-linux-static-x86_64
docker-19.03.1-linux-static-x86_64
docker-42.42.1-binsh-test-stub <span class=c1># only for development version</span>
</code></pre></div> <p>It shows the list of the built-in packages which can be used right away as an option to the <code>--docker-client</code> argument.</p> <p>This list does not highlight the default one, so here a short description about each of these:</p> <ul> <li><code>docker-17.12.0-ce-linux-static-x86_64</code>: this version was in use when using the <a href=../../lib/pipelines/docker-client-install.sh><code>docker-client-install.sh</code></a> script inside a pipeline.</li> <li><code>docker-18.09.1-linux-static-x86_64</code>: this version was found in use by the Atlassian Bitbucket Cloud Pipelines Plugin: <div class=highlight><pre><span></span><code>$ docker --version
Docker version <span class=m>18</span>.09.1, build 4c52b90
</code></pre></div></li> <li><code>docker-19.03.1-linux-static-x86_64</code>: the version used mainly to develop pipelines, in specific the Docker Service feature, which was sort of current while doing the development work. It includes fixes in environment variable handling (18.07.0 / <a href=https://github.com/docker/cli/pull/1019>docker/cli#1019</a>) which prevented pipelines to properly import environment variables from the users' environment by environment variable files. This became prominent back in April 2018.</li> <li><code>docker-42.42.1-binsh-test-stub</code>: a fake package used for testing that is not a Docker client at all. When the pipelines project is cloned, this is the only package that works offline out of the box and is only available after <code>composer install</code> has been run.</li> </ul> <h2 id=create-docker-client-static-binary-packages-for-pipelines>Create Docker Client Static Binary Packages for Pipelines<a class=headerlink href=#create-docker-client-static-binary-packages-for-pipelines title="Permanent link">&para;</a></h2> <p>It might not be always in your case that pipelines ships with the package of your wish.</p> <h3 id=find-the-binary-and-download-the-release-package>Find the binary and download the release package<a class=headerlink href=#find-the-binary-and-download-the-release-package title="Permanent link">&para;</a></h3> <p>Docker binaries are available for different platforms from the <code>download.docker.com</code> website:</p> <ul> <li><a href=https://download.docker.com/linux/static/stable/x86_64/ >https://download.docker.com/linux/static/stable/x86_64/</a></li> </ul> <p>Browse for the version that you need to work in a pipeline container, it might be necessary to change the architecture, fiddle with the path component of the URL above.</p> <p>In writing this how-to the docker-17.12.0-ce.tgz for Linux x86_64 has been created exemplary (it is now part of pipelines):</p> <ul> <li><a href=https://download.docker.com/linux/static/stable/x86_64/docker-17.12.0-ce.tgz>https://download.docker.com/linux/static/stable/x86_64/docker-17.12.0-ce.tgz</a></li> </ul> <p>To download a utility like <code>wget</code> or similar can be used:</p> <div class=highlight><pre><span></span><code>$ wget https://download.docker.com/linux/static/stable/x86_64/docker-17.12.0-ce.tgz
--2019-12-15 <span class=m>17</span>:10:57--  https://download.docker.com/linux/static/stable/x86_64/docker-17.12.0-ce.tgz
Resolving download.docker.com <span class=o>(</span>download.docker.com<span class=o>)</span>... <span class=m>2600</span>:9000:21c7:ac00:3:db06:4200:93a1, <span class=m>2600</span>:9000:21c7:a200:3:db06:4200:93a1, <span class=m>2600</span>:9000:21c7:5c00:3:db06:4200:93a1, ...
Connecting to download.docker.com <span class=o>(</span>download.docker.com<span class=o>)</span><span class=p>|</span><span class=m>2600</span>:9000:21c7:ac00:3:db06:4200:93a1<span class=p>|</span>:443... connected.
HTTP request sent, awaiting response... <span class=m>200</span> OK
Length: <span class=m>34272897</span> <span class=o>(</span>33M<span class=o>)</span> <span class=o>[</span>application/x-tar<span class=o>]</span>
Saving to: &lsquo;docker-17.12.0-ce.tgz&rsquo;

docker-17.12.0-ce.tgz                               <span class=m>100</span>%<span class=o>[=</span>. .. <span class=o>=</span>&gt;<span class=o>]</span>  <span class=m>32</span>,68M  ?,79MB/s    in ?,8s

<span class=m>2019</span>-12-15 <span class=m>17</span>:11:02 <span class=o>(</span><span class=m>6</span>,76 MB/s<span class=o>)</span> - &lsquo;docker-17.12.0-ce.tgz&rsquo; saved <span class=o>[</span><span class=m>34272897</span>/34272897<span class=o>]</span>
</code></pre></div> <h3 id=obtain-meta-information>Obtain Meta-Information<a class=headerlink href=#obtain-meta-information title="Permanent link">&para;</a></h3> <p>As of time of writing, a package in pipelines for the docker client binary contains a bit more meta-information than the download location:</p> <ul> <li>The name of the package - to identify it, in this how-to we take <code>docker-17.12.0-ce-linux-static-x86_64</code>, the name should be portable</li> <li>The URI - in this how-to it is the https URL of the download package</li> <li>The SHA-256 checksum of the download package - to verify if the download was successful (complete)</li> <li>The path of the docker binary inside the download package - this path is needed for extraction</li> <li>The SHA-256 checksum of the docker binary - to verify extraction from the package was successful (complete)</li> </ul> <p>To create the SHA-256 checksum of the download package:</p> <div class=highlight><pre><span></span><code>$ shasum -a256 docker-17.12.0-ce.tgz
692e1c72937f6214b1038def84463018d8e320c8eaf8530546c84c2f8f9c767d  docker-17.12.0-ce.tgz
</code></pre></div> <p>Next look into the download package for the path of the docker client:</p> <div class=highlight><pre><span></span><code>$ tar -tvf docker-17.12.0-ce.tgz
drwxr-xr-x <span class=m>0</span>/1000            <span class=m>0</span> <span class=m>2017</span>-12-27 <span class=m>21</span>:13 docker/
-rwxr-xr-x <span class=m>0</span>/1000      <span class=m>4320064</span> <span class=m>2017</span>-12-27 <span class=m>21</span>:13 docker/docker-containerd-shim
-rwxr-xr-x <span class=m>0</span>/1000     <span class=m>15433832</span> <span class=m>2017</span>-12-27 <span class=m>21</span>:13 docker/docker-containerd
-rwxr-xr-x <span class=m>0</span>/1000      <span class=m>7550928</span> <span class=m>2017</span>-12-27 <span class=m>21</span>:13 docker/docker-runc
-rwxr-xr-x <span class=m>0</span>/1000     <span class=m>19938610</span> <span class=m>2017</span>-12-27 <span class=m>21</span>:13 docker/docker
-rwxr-xr-x <span class=m>0</span>/1000       <span class=m>760040</span> <span class=m>2017</span>-12-27 <span class=m>21</span>:13 docker/docker-init
-rwxr-xr-x <span class=m>0</span>/1000     <span class=m>12773768</span> <span class=m>2017</span>-12-27 <span class=m>21</span>:13 docker/docker-containerd-ctr
-rwxr-xr-x <span class=m>0</span>/1000      <span class=m>2517244</span> <span class=m>2017</span>-12-27 <span class=m>21</span>:13 docker/docker-proxy
-rwxr-xr-x <span class=m>0</span>/1000     <span class=m>46366152</span> <span class=m>2017</span>-12-27 <span class=m>21</span>:13 docker/dockerd
</code></pre></div> <p>It normally is <code>docker/docker</code> and so it is in this how-to. Locate the path and create a SHA-256 checksum of it:</p> <div class=highlight><pre><span></span><code>$ tar -xf docker-17.12.0-ce.tgz -O docker/docker <span class=p>|</span> shasum -a256
c77a64bf37b4e89cc4d6f35433baa44fb33e6f89e2f2c3406256e55f7a05504b  -
</code></pre></div> <p>Now all required meta-data has been obtained to create a package.</p> <h3 id=encode-meta-information-into-a-yaml-file>Encode Meta-Information into a YAML File<a class=headerlink href=#encode-meta-information-into-a-yaml-file title="Permanent link">&para;</a></h3> <p>The only thing left to fully produce a package file is to encode the collected information as YAML:</p> <div class=highlight><pre><span></span><code>$ <span class=s>&lt;&lt;'YAML' cat &gt; docker-17.12.0-ce-linux-static-x86_64.yml</span>
<span class=s>---</span>
<span class=s># this file is part of pipelines</span>
<span class=s>#</span>
<span class=s># binary docker client package format</span>
<span class=s>#</span>
<span class=s>name: docker-17.12.0-ce-linux-static-x86_64</span>
<span class=s>uri: https://download.docker.com/linux/static/stable/x86_64/docker-17.12.0-ce.tgz</span>
<span class=s>sha256: 692e1c72937f6214b1038def84463018d8e320c8eaf8530546c84c2f8f9c767d</span>
<span class=s>binary: docker/docker</span>
<span class=s>binary_sha256: c77a64bf37b4e89cc4d6f35433baa44fb33e6f89e2f2c3406256e55f7a05504b</span>
<span class=s>YAML</span>
</code></pre></div> <p>When done you find a <code>.yml</code> file with the name in the current directory.</p> <blockquote> <p><strong><em>Note:</em></strong> You can find another description of each part of the package format in the commented package after <code>composer install</code>: <a href=../../lib/package/docker-42.42.1-binsh-test-stub.yml>lib/package/docker-42.42.1-binsh-test-stub.yml</a></p> </blockquote> <p>This package <code>.yml</code> file can already be used for a first test to see if it works. Just run <code>pipelines</code> with the <code>--docker-client</code> option having the path to the <code>.yml</code> file as argument:</p> <div class=highlight><pre><span></span><code>$ bin/pipelines --pipeline custom/docker <span class=se>\</span>
    --docker-client docker-17.12.0-ce-linux-static-x86_64.yml
...
 +++ docker client install...: Docker version <span class=m>17</span>.12.0-ce, build c97c6d6

+ docker version --format <span class=o>{{</span>.Client.Version<span class=o>}}</span>
<span class=m>17</span>.12.0-ce
...
</code></pre></div> <p>This runs pipelines with a pipeline that has the docker service and therefore injects the docker client binary from the package <code>.yml</code> file provided by <code>--docker-client</code> argument. In this case the projects' custom pipeline named "<em>docker-in-docker</em>" (id: <code>custom/docker</code>).</p> <p>The benefit of having a <code>.yml</code> package file is that all the meta- information is already documented, including on how to obtain the file.</p> <p>This includes benefiting for a user-wide store of checksum/hash'ed files.</p> <p>The tar package files are <em>cached</em> in the <code>XDG_CACHE_HOME</code> directory, which by default is:</p> <div class=highlight><pre><span></span><code>~/.cache/pipelines/package-docker
</code></pre></div> <p>As long as the user decides to keep the cache, this spares downloading of the tar package again and again.</p> <p>The docker client binaries are not cached but kept and <em>stored</em> so that they are available in user-land until the user decides to remove the application in the <code>XDG_DATA_HOME</code> directory:</p> <div class=highlight><pre><span></span><code>~/.local/share/pipelines/static-docker
</code></pre></div> <h3 id=add-packages-to-pipelines-project>Add Packages to Pipelines Project<a class=headerlink href=#add-packages-to-pipelines-project title="Permanent link">&para;</a></h3> <p>Instead of having a <code>.yml</code> package somewhere on the local disk it is better to add it to the pipelines utility itself.</p> <p>Copy the file into the source directory for package files (<em>here</em> from within a checked-out copy of the pipelines project):</p> <div class=highlight><pre><span></span><code>$ cp -vi docker-17.12.0-ce-linux-static-x86_64.yml lib/package
<span class=s1>'docker-17.12.0-ce-linux-static-x86_64.yml'</span> -&gt;  ...
 ... <span class=s1>'lib/package/docker-17.12.0-ce-linux-static-x86_64.yml'</span>
</code></pre></div> <p>To test if the new package name works, invoke Pipelines with the <em>name</em> of this package (not the full file-name or path, e.g. not the path to the file but just the basename of it excluding the <code>.yml</code> extension) with a pipeline that is making use of the docker service, here exemplary again with the projects' custom pipeline named "<em>docker-in-docker</em>" (<code>custom/docker</code>):</p> <div class=highlight><pre><span></span><code>$ bin/pipelines --pipeline custom/docker <span class=se>\</span>
    --docker-client docker-17.12.0-ce-linux-static-x86_64
<span class=o>[</span>...<span class=o>]</span>
 +++ docker client install...: Docker version <span class=m>17</span>.12.0-ce, build c97c6d6

+ docker version --format <span class=o>{{</span>.Client.Version<span class=o>}}</span>
<span class=m>17</span>.12.0-ce
<span class=o>[</span>...<span class=o>]</span>
</code></pre></div> <blockquote> <p><strong><em>Note:</em></strong> If you wish to see a specific package of yours also within the upstream distribution feel free to <em>file a pull-request</em>.</p> </blockquote> <h2 id=last-but-not-least-use-a-custom-build-static-docker-client-binary>Last but not Least: Use a Custom Build Static Docker Client Binary<a class=headerlink href=#last-but-not-least-use-a-custom-build-static-docker-client-binary title="Permanent link">&para;</a></h2> <p>Pipelines as an integration utility allows to use docker client binaries directly. For example a binary created from a docker client development build.</p> <p>In this variant, no package exists at all and the binary is just given as the <code>--docker-client</code> options argument as path to the binary. No download will take place, so is no caching nor adding to any local store (this is all not needed, the file already exists locally). The package is only temporary so to say and the meta-information is non- existent.</p> <p>This mode of operation is very useful for testing any kind of binary as a docker client.</p> <p>To distinguish between a package name and binary potentially of that same name, the <code>--docker-client</code> argument needs to have at least a single slash ("<code>/</code>") in the path to the binary.</p> <p>For example, if the docker client binary is just a local file in the working directory prefix it with <code>./</code> so that pipelines can understand it is not a package of the same name.</p> <p>For example with the test stub that is available in pipelines development:</p> <div class=highlight><pre><span></span><code>$ bin/pipelines --pipeline custom/docker <span class=se>\</span>
    --docker-client test/data/package/docker-test-stub
<span class=o>[</span>...<span class=o>]</span>
 +++ docker client install...: <span class=m>42</span>.42.1 <span class=o>(</span> --version <span class=o>)</span>

+ docker version --format <span class=o>{{</span>.Client.Version<span class=o>}}</span>
<span class=m>42</span>.42.1 <span class=o>(</span> version --format <span class=o>{{</span>.Client.Version<span class=o>}}</span> <span class=o>)</span>
<span class=o>[</span>...<span class=o>]</span>
</code></pre></div> <p>Here a fake <code>.sh</code> script is used as the docker client binary which outputs a bogus version number (<code>42.42.1</code>) and all options and arguments with which it was invoked which makes it suitable for testing purposes.</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../CONFIGURATION-PARAMETERS.html class="md-footer-nav__link md-footer-nav__link--prev" rel=prev title="Previous: Configuration Parameters"> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Configuration Parameters </div> </div> </a> <a href=../PIPELINES-HOWTO-ROOTLESS.html class="md-footer-nav__link md-footer-nav__link--next" rel=next title="Next: Rootless Pipelines"> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Rootless Pipelines </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made by <a href=https://ktomk.github.io/ title="Ktomk home on Github Pages"> Ktomk on Github.io </a> </div> <div class=md-footer-social> <a href=https:/ktomk.github.io/pipelines/index.html target=_blank rel=noopener title="Pipelines homepage" class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 96 96"> <path d="m 48.001503,8 c -3.067868,0 -6.135869,1.17553 -8.486698,3.52617 L 11.526141,39.51326 c -4.7015212,4.70127 -4.7015212,12.27021 0,16.97135 l 17.024333,17.02351 9.563268,-29.42914 a 6.6334399,6.6329078 0 0 1 0.151061,-0.49991 6.6334399,6.6329078 0 0 1 0.169254,-0.48603 L 49.792552,8.13582 C 49.199219,8.04692 48.600226,8 48.001503,8 Z m 13.110599,8.14969 -5.941417,18.28527 h 24.228283 z m -9.951098,31.52579 a 6.6334399,6.6329078 0 0 1 -0.284874,0.0135 6.6334399,6.6329078 0 0 1 -0.169255,0.4847 l -11.647547,35.84504 0.455477,0.45544 c 4.701656,4.70116 12.271874,4.70116 16.973395,0 L 84.477538,56.48694 c 2.433434,-2.43311 3.60366,-5.63438 3.518089,-8.80901 z"/> </svg> </a> <a href=https://github.com/ktomk/pipelines target=_blank rel=noopener title="Pipelines utility Github repository" class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://hub.docker.com/r/ktomk/pipelines target=_blank rel=noopener title="Pipelines test container images on Docker Hub" class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href=https://ktomk.github.io/ target=_blank rel=noopener title=ktomk.github.io class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"/></svg> </a> <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener title="Made with Material for MkDocs + Mkdocs + Makefile + <3" class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.7e0ee788.min.js></script> <script src=../../assets/javascripts/bundle.c1ccee15.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script src=../../assets/javascripts/iframe-worker.js></script> <script src=../../search/search_index.js></script> <script>
        app = initialize({
          base: "../..",
          features: ['tabs', 'navigation.tabs'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>
