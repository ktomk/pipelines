<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://ktomk.github.io/pipelines/doc/PIPELINES-OFFLINE.html><link rel=icon href=../assets/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.0.3"><title>Working Offline - Pipelines - Run Bitbucket Pipelines Wherever They Dock</title><link rel=stylesheet href=../assets/stylesheets/main.62128196.min.css><link rel=stylesheet href=../assets/stylesheets/palette.9204c3b2.min.css><link rel=stylesheet href=../assets/extra.css><script>function __md_scope(e,t,_){return new URL(_||(t===localStorage?"..":".."),location).pathname+"."+e}function __md_get(e,t=localStorage,_){return JSON.parse(t.getItem(__md_scope(e,t,_)))}function __md_set(e,t,_=localStorage,o){try{_.setItem(__md_scope(e,_,o),JSON.stringify(t))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#working-offline class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../index.html title="Pipelines - Run Bitbucket Pipelines Wherever They Dock" class="md-header__button md-logo" aria-label="Pipelines - Run Bitbucket Pipelines Wherever They Dock" data-md-component=logo> <img src=../assets/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Pipelines - Run Bitbucket Pipelines Wherever They Dock </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Working Offline </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ktomk/pipelines/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ktomk/pipelines </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../index.html class=md-tabs__link> Read Me </a> </li> <li class=md-tabs__item> <a href=GETTING-STARTED.html class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=PIPELINES-OFFLINE.html class="md-tabs__link md-tabs__link--active"> Docs </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../index.html title="Pipelines - Run Bitbucket Pipelines Wherever They Dock" class="md-nav__button md-logo" aria-label="Pipelines - Run Bitbucket Pipelines Wherever They Dock" data-md-component=logo> <img src=../assets/logo.svg alt=logo> </a> Pipelines - Run Bitbucket Pipelines Wherever They Dock </label> <div class=md-nav__source> <a href=https://github.com/ktomk/pipelines/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ktomk/pipelines </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Read Me <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Read Me" data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Read Me </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../index.html class=md-nav__link> Pipelines </a> </li> <li class=md-nav__item> <a href=../CHANGELOG.html class=md-nav__link> Change Log </a> </li> <li class=md-nav__item> <a href=../COPYING.html class=md-nav__link> Copying </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=GETTING-STARTED.html class=md-nav__link> Getting Started </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Docs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docs data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Working Offline <span class="md-nav__icon md-icon"></span> </label> <a href=PIPELINES-OFFLINE.html class="md-nav__link md-nav__link--active"> Working Offline </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#general-considerations class=md-nav__link> General Considerations </a> <nav class=md-nav aria-label="General Considerations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-docker-containers class=md-nav__link> Local Docker Containers </a> </li> <li class=md-nav__item> <a href=#build-dependencies class=md-nav__link> Build Dependencies </a> <nav class=md-nav aria-label="Build Dependencies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#caching-of-build-dependencies class=md-nav__link> Caching of Build Dependencies </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#remote-build-services class=md-nav__link> Remote Build Services </a> </li> <li class=md-nav__item> <a href=#test-offline-usage class=md-nav__link> Test Offline Usage </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#special-offline-requirements class=md-nav__link> Special Offline Requirements </a> <nav class=md-nav aria-label="Special Offline Requirements"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#individual-http-caching class=md-nav__link> Individual HTTP Caching </a> </li> <li class=md-nav__item> <a href=#cache-alpine-apk-packages class=md-nav__link> Cache Alpine APK Packages </a> </li> <li class=md-nav__item> <a href=#cache-python-pip-install class=md-nav__link> Cache Python pip install </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=PIPELINES-CACHES.html class=md-nav__link> Working with Pipeline Caches </a> </li> <li class=md-nav__item> <a href=PIPELINES-SERVICES.html class=md-nav__link> Working with Pipeline Services </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Reference data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=PIPELINES-VARIABLE-REFERENCE.html class=md-nav__link> Pipelines Environment Variable Usage </a> </li> <li class=md-nav__item> <a href=CONFIGURATION-PARAMETERS.html class=md-nav__link> Configuration Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5> How-To <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=How-To data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> How-To </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=PIPELINES-HOWTO-DOCKER-CLIENT-BINARY.html class=md-nav__link> Docker Client Binary Packages for Pipelines </a> </li> <li class=md-nav__item> <a href=PIPELINES-HOWTO-ROOTLESS.html class=md-nav__link> Rootless Pipelines </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6 type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6> Appendix <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Appendix data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Appendix </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=DEVELOPMENT.html class=md-nav__link> Utility Development </a> </li> <li class=md-nav__item> <a href=../lib/build/mkdocs/index.html class=md-nav__link> HTML Documentation Build </a> </li> <li class=md-nav__item> <a href=DOCKER-NAME-TAG.html class=md-nav__link> Docker Container (Image/Tag) Name Syntax </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#general-considerations class=md-nav__link> General Considerations </a> <nav class=md-nav aria-label="General Considerations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-docker-containers class=md-nav__link> Local Docker Containers </a> </li> <li class=md-nav__item> <a href=#build-dependencies class=md-nav__link> Build Dependencies </a> <nav class=md-nav aria-label="Build Dependencies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#caching-of-build-dependencies class=md-nav__link> Caching of Build Dependencies </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#remote-build-services class=md-nav__link> Remote Build Services </a> </li> <li class=md-nav__item> <a href=#test-offline-usage class=md-nav__link> Test Offline Usage </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#special-offline-requirements class=md-nav__link> Special Offline Requirements </a> <nav class=md-nav aria-label="Special Offline Requirements"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#individual-http-caching class=md-nav__link> Individual HTTP Caching </a> </li> <li class=md-nav__item> <a href=#cache-alpine-apk-packages class=md-nav__link> Cache Alpine APK Packages </a> </li> <li class=md-nav__item> <a href=#cache-python-pip-install class=md-nav__link> Cache Python pip install </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ktomk/pipelines/edit/master/doc/PIPELINES-OFFLINE.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=working-offline>Working Offline<a class=headerlink href=#working-offline title="Permanent link">&para;</a></h1> <p>Running <code>pipelines</code> locally allows offline usage.</p> <p>This is by design, however existing pipelines, especially when written for a remote service like Bitbucket, might not work out of the box and need some preparation.</p> <p>This is not inherently hard and this document shows hand-on advice how to do it.</p> <p>A build is best run locally and a stable one should not depend (always) on remote resources so that it has less brittle dependencies and executes fast on the many re-iterations.</p> <p>Running the build locally and with no connection to the internet is a simple test for that.</p> <p>The <code>pipelines</code> utility as well as the pipelines YAML file-format have plenty of properties to support a more independent and faster build.</p> <p>In this document, read about more general considerations and also find some specific examples for offline usage of pipelines incl. containers and what to do with remote files, dependencies and packages.</p> <h2 id=general-considerations>General Considerations<a class=headerlink href=#general-considerations title="Permanent link">&para;</a></h2> <p>Pipelines are based on Docker containers. Their images need to be pulled if not stored locally.</p> <h3 id=local-docker-containers>Local Docker Containers<a class=headerlink href=#local-docker-containers title="Permanent link">&para;</a></h3> <p>Before going into offline mode, make use of <code>--images</code> and the shell:</p> <div class=highlight><pre><span></span><code>$ pipelines --images <span class=p>|</span> <span class=k>while</span> <span class=nb>read</span> -r image<span class=p>;</span> <span class=k>do</span> <span class=se>\</span>
   docker image pull <span class=s2>&quot;</span><span class=nv>$image</span><span class=s2>&quot;</span><span class=p>;</span> <span class=k>done</span><span class=p>;</span>
</code></pre></div> <p>If there are specific Docker container images in a project, build all images before going offline as these at some place at least depend on a base container and resources in such container definitions that are very likely not to exist locally.</p> <p>That is because building Docker images most often make use of remote resources that are unavailable when not connected to the internet.</p> <p>Remember: Pipelines always prefers locally stored containers. As long as they are available, no internet connection is required to use them.</p> <h3 id=build-dependencies>Build Dependencies<a class=headerlink href=#build-dependencies title="Permanent link">&para;</a></h3> <p>Pulling Docker images might not suffice to run a pipeline with <code>pipelines</code> completely offline.</p> <p>For example when fetching build dependencies with tools like <code>npm</code> or <code>composer</code>, these can not be installed when offline.</p> <p>First of all <code>pipelines</code> is relatively immune to such an effect if these dependencies were already installed within the project. As <code>pipelines</code> makes a full copy of the project into the pipeline container, dependencies might already be available.</p> <p>However this might not always be the case and then offline usage would be broken. A build might also use different than the development dependencies to build and therefore would need to fetch while offline.</p> <h4 id=caching-of-build-dependencies>Caching of Build Dependencies<a class=headerlink href=#caching-of-build-dependencies title="Permanent link">&para;</a></h4> <p>Caches within <code>pipelines</code> can be used to cache build dependencies. Add caches to your pipelines by giving them a distinct name (all caches are shared on a per project basis) and run the pipelines before going offline to populate the cache.</p> <p>When the build utilities support a cache to fall back to when being offline, this is an easy way to not only make pipelines faster by sparing network round-trips, but also to make them work with no internet connection.</p> <p>Read more about caches in <a href=PIPELINES-CACHES.html><em>Working with Pipeline Caches</em></a>.</p> <h3 id=remote-build-services>Remote Build Services<a class=headerlink href=#remote-build-services title="Permanent link">&para;</a></h3> <p>Despite all the offline capabilities, when a pipeline step fires webhooks or uploads build artifacts to remote services, this can not be done offline.</p> <p>The remote service is a hard dependency of the pipeline then.</p> <p>A prominent example for that are for example deployment steps as most often they need to interact with remote services.</p> <p>Depending on your build needs, this may be a showstopper.</p> <p>To not be completely blocked from building in an offline situation, this can be handled by separating artifacts creation from uploading them in pipeline steps of their own.</p> <p>Pipeline <em>artifacts</em> can be used to make build artifacts from one step available in the following steps.</p> <p><code>pipelines</code> then can run those pipeline steps specifically which are not affected when being offline with the <code>--step</code> argument and artifacts afterwards inspected within your project.</p> <h3 id=test-offline-usage>Test Offline Usage<a class=headerlink href=#test-offline-usage title="Permanent link">&para;</a></h3> <p>As there is no guarantee that using pipelines offline works out of the box, it is useful to give it a test-run before entering a true offline situation.</p> <p>This can be done by actually going offline and do the development work including running the pipelines needed for it if being offline is not your standard way to work (hard to imagine for some persons nowadays, give it a try if you think so as it can be very interesting how hard you're affected by that with benefits working online as well).</p> <h2 id=special-offline-requirements>Special Offline Requirements<a class=headerlink href=#special-offline-requirements title="Permanent link">&para;</a></h2> <p>For some containers it might be standard to modify their base-images' environment on a pipeline run. For example, a PHP image is optimized for a build pipeline step by installing composer and system packages like unzip and git.</p> <p>While it could be better to actually build dedicated build-images of their own and have them at hand already in the pipeline step, while developing intermediate results might be achieved differently. Before introducing too much into generic base container images too early, it is often preferable as these things tend to change a lot in the beginning to do the groundwork in a less fixed fashion, for example by extending a pipeline step script first.</p> <p>As <code>pipelines</code> is a development utility, find more specialized offline configurations following.</p> <h3 id=individual-http-caching>Individual HTTP Caching<a class=headerlink href=#individual-http-caching title="Permanent link">&para;</a></h3> <p>Obtaining files via http while building can be common, e.g. when installing more specific tools or libraries.</p> <p>One example of that within the <code>pipelines</code> project itself is the composer install script. That is a simple shell script wrapping the composer installation.</p> <p>As it normally acquires the composer installer from Github, it won't work offline (and would always need to download the composer installer and composer itself).</p> <p>The whole process can be short-circuited within the pipeline script already by not calling the composer installer script when composer is already installed:</p> <p><div class=highlight><pre><span></span><code>  <span class=nt>script</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">command -v composer || lib/pipelines/composer-install.sh</span>
</code></pre></div> (<em>unless the composer command is installed, install it</em>)</p> <p>It would already be installed for example if the <code>--keep</code> option is in use as the container would be re-used with all the file-system changes.</p> <p>The <code>--keep</code> option most certainly is not applicable when working offline (despite it could help in some situations).</p> <p>Instead the individual http caching is in the script <a href=../lib/pipelines/composer-install.sh><code>lib/pipelines/composer-install.sh</code></a> itself.</p> <p>The solution is simple. The script changes the working directory into a http-caching directory <code>~/.cache/build-http-cache</code> and unless files are already available they are downloaded relative to this working directory.</p> <p>In the pipelines file the cache is defined and all downloads get automatically cached:</p> <div class=highlight><pre><span></span><code><span class=nt>definitions</span><span class=p>:</span>
  <span class=nt>caches</span><span class=p>:</span>
    <span class=nt>build-http-cache</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">~/.cache/build-http-cache</span>
</code></pre></div> <p>More is not needed to cache things. A simple shell script can help in maintaining the procedure.</p> <p>This is just exemplary. Composer offers its own docker image. Also the package manager of the Linux distribution may also have Composer available as a package. So take this example with a grain of salt. It is more an example how HTTP caching <em>can</em> be done than how it should be done.</p> <p>Strategically it is most often better to prepare build containers and have their lifecycle well defined on project level.</p> <ul> <li><a href=example/individual-http-cache-pipelines.yml>Individual HTTP Cache example pipelines file</a></li> <li><a href=../lib/pipelines/composer-install.sh>Composer installer wrapper shell script</a></li> </ul> <h3 id=cache-alpine-apk-packages>Cache Alpine APK Packages<a class=headerlink href=#cache-alpine-apk-packages title="Permanent link">&para;</a></h3> <p>In Alpine based container images, the apk package manager commonly is in use. By default these dependencies can not be cached with predefined Pipeline caches as there is no such apk-cache predefined.</p> <p>To nevertheless make use of <code>apk add &lt;package&gt;</code> within a pipeline while being offline, the folder <code>/etc/apk/cache</code> needs to be cached by defining a cache (here <code>apk</code>) and using it:</p> <div class=highlight><pre><span></span><code>          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apk add bash</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/bin/bash --version</span>
       <span class=" -Error"> </span><span class=nt>caches</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apk</span>
<span class=nt>definitions</span><span class=p>:</span>
  <span class=nt>caches</span><span class=p>:</span>
    <span class=nt>apk</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/apk/cache</span>
</code></pre></div> <p>Once the apk cache is populated, the pipeline runs offline despite the <code>bash</code> package is installed in the pipeline script. This first of all works without further ado, after some time, <code>apk</code> tries to re-connect for getting a fresh package index. This will cost some 2-3 seconds, as <code>apk</code> does this two times, see the <em>try again later</em> messages, but as the package is found in the cache, adding the package works without any error:</p> <div class=highlight><pre><span></span><code>...
fetch http://dl-cdn.alpinelinux.org/alpine/v3.12/main/x86_64/APKINDEX.tar.gz
ERROR: http://dl-cdn.alpinelinux.org/alpine/v3.12/main: temporary error (try again later)
fetch http://dl-cdn.alpinelinux.org/alpine/v3.12/community/x86_64/APKINDEX.tar.gz
ERROR: http://dl-cdn.alpinelinux.org/alpine/v3.12/community: temporary error (try again later)
(1/4) Installing ncurses-terminfo-base (6.2_p20200523-r0)
...
</code></pre></div> <details class="- caution"><summary>The <code>--no-cache</code> Option</summary><p>Do not use <code>apk add</code> with the <code>--no-cache</code> argument. It effectively prevents storing the files into the cache. Then, when offline, <code>apk(1)</code> can not select the package and gives an error message showing that apk failed to select the package. This is different to a Dockerfile that keeps a layer size down. This is normally <em>not</em> the case within a pipeline.</p> </details> <p>Tested with alpine releases 3.12.0 and 3.13.5.</p> <p>References:</p> <ul> <li><a href=example/alpine-apk-cache-pipelines.yml>Alpine APK Cache example pipelines file</a></li> <li><a href=https://wiki.alpinelinux.org/wiki/Alpine_Linux_package_management#Special_Caching_Configurations>Alpine Special Caching Configurations (wiki.alpinelinux.org)</a></li> <li><a href=https://hub.docker.com/_/alpine>Alpine Docker Image</a></li> <li><a href=https://alpinelinux.org/ >Alpine Linux</a></li> </ul> <h3 id=cache-python-pip-install>Cache Python <code>pip install</code><a class=headerlink href=#cache-python-pip-install title="Permanent link">&para;</a></h3> <p>Enriching a Python based pipeline with pip install (see as well <a href=https://pip.pypa.io/en/stable/user_guide/#installing-packages><em>Installing Packages</em> in the pip manual</a>) can be cached up to full package downloads (which is a requirement when working offline).</p> <p>A common example is the use of a <code>requirements.txt</code> file, it works likewise with package names:</p> <div class=highlight><pre><span></span><code>$ pip install --user -r requirements.txt
</code></pre></div> <p>Next to the pre-defined <code>pip</code> cache, to use pip offline fully, the installed packages need to be cached, too.</p> <p>To not cache all Python packages (that would include all those a pipeline container image already contains which would be bulky) pip offers the <code>--user</code> flag to install the packages into the user-site. That is a separate location, by default beneath the <code>$HOME</code> directory, to install to (see as well <a href=https://pip.pypa.io/en/stable/user_guide/#user-installs><em>User Installs</em> in the pip manual</a>).</p> <p>This "user-site" directory can be obtained with the following <code>python</code> command:</p> <div class=highlight><pre><span></span><code>$ python -m site --user-site
/home/user/.local/lib/python/site-packages
</code></pre></div> <p>This needs to be obtained in concrete with the actual pipeline container image, e.g. the docker image for the mkdocs-material based build that <code>pipelines</code> is using to build the HTML docs which is in use for this example:</p> <div class=highlight><pre><span></span><code>$ docker run --rm --entrypoint /bin/sh squidfunk/mkdocs-material \
    -c &#39;python -m site --user-site&#39;
/root/.local/lib/python3.8/site-packages
</code></pre></div> <p>The output already shows the site-packages directory which is the cache directory. The <code>$HOME</code> part of it can be abbreviated in pipelines with the tilde (<code>~</code>) or <code>$HOME</code>:</p> <p><div class=highlight><pre><span></span><code>definitions:
  caches:
    pip-site-packages: ~/.local/lib/python3.8/site-packages
</code></pre></div> (<em>define a pipeline cache for pip site-packages, here the user is "root"</em>)</p> <p>With such a pip site packages cache in use, the pip install command can run offline already.</p> <p>This is not complete for <em>all</em> packages. <em>Some</em> pip packages install more, for example commands into <code>~/.local/bin</code>. These need another cache just for that folder:</p> <div class=highlight><pre><span></span><code>  caches:
    pip-site-packages: ~/.local/lib/python3.8/site-packages
    localbin: ~/.local/bin
</code></pre></div> <p>That done, for the example of a tailored build with the <code>mkdocs-material</code> image, the python based pipeline runs flawlessly offline (with all the benefits of running much faster locally even when online).</p> <p>References:</p> <ul> <li><a href=example/python-pip-cache-pipelines.yml>Python PIP Cache example pipelines file</a></li> <li><a href=https://pip.pypa.io/en/stable/user_guide/#installing-packages>PIP Installing Packages</a></li> <li><a href=https://pip.pypa.io/en/stable/user_guide/#user-installs>PIP User Installs</a></li> </ul> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=GETTING-STARTED.html class="md-footer__link md-footer__link--prev" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Getting Started </div> </div> </a> <a href=PIPELINES-CACHES.html class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Working with Pipeline Caches </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made by <a href=https://ktomk.github.io/ title="Ktomk home on Github Pages"> Ktomk on Github.io </a> </div> <div class=md-social> <a href=https://ktomk.github.io/pipelines/ target=_blank rel=noopener title="Pipelines homepage" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 96 96"> <path d="m 48.001503,8 c -3.067868,0 -6.135869,1.17553 -8.486698,3.52617 L 11.526141,39.51326 c -4.7015212,4.70127 -4.7015212,12.27021 0,16.97135 l 17.024333,17.02351 9.563268,-29.42914 a 6.6334399,6.6329078 0 0 1 0.151061,-0.49991 6.6334399,6.6329078 0 0 1 0.169254,-0.48603 L 49.792552,8.13582 C 49.199219,8.04692 48.600226,8 48.001503,8 Z m 13.110599,8.14969 -5.941417,18.28527 h 24.228283 z m -9.951098,31.52579 a 6.6334399,6.6329078 0 0 1 -0.284874,0.0135 6.6334399,6.6329078 0 0 1 -0.169255,0.4847 l -11.647547,35.84504 0.455477,0.45544 c 4.701656,4.70116 12.271874,4.70116 16.973395,0 L 84.477538,56.48694 c 2.433434,-2.43311 3.60366,-5.63438 3.518089,-8.80901 z"/> </svg> </a> <a href=https://github.com/ktomk/pipelines target=_blank rel=noopener title="Pipelines utility Github repository" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://hub.docker.com/r/ktomk/pipelines target=_blank rel=noopener title="Pipelines test container images on Docker Hub" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href=https://ktomk.github.io/ target=_blank rel=noopener title=ktomk.github.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"/></svg> </a> <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener title="Made with Material for MkDocs + Mkdocs + Makefile + <3" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["tabs", "navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.01824240.min.js"}</script> <script src=../assets/javascripts/iframe-worker-0.2.0.js></script> <script src=../search/search_index.js></script> <script src=../assets/javascripts/bundle.e0abf5b0.min.js></script> </body> </html>