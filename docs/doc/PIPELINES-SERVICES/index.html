<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://ktomk.github.io/pipelines/doc/PIPELINES-SERVICES.html rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.0.3"><title>Working with Pipeline Services - Pipelines - Run Bitbucket Pipelines Wherever They Dock</title><link rel=stylesheet href=../../assets/stylesheets/main.62128196.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.9204c3b2.min.css><link rel=stylesheet href=../../assets/extra.css><script>function __md_scope(e,t,_){return new URL(_||(t===localStorage?"../..":"../.."),location).pathname+"."+e}function __md_get(e,t=localStorage,_){return JSON.parse(t.getItem(__md_scope(e,t,_)))}function __md_set(e,t,_=localStorage,o){try{_.setItem(__md_scope(e,_,o),JSON.stringify(t))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#working-with-pipeline-services class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../index.html title="Pipelines - Run Bitbucket Pipelines Wherever They Dock" class="md-header__button md-logo" aria-label="Pipelines - Run Bitbucket Pipelines Wherever They Dock" data-md-component=logo> <img src=../../assets/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Pipelines - Run Bitbucket Pipelines Wherever They Dock </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Working with Pipeline Services </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ktomk/pipelines/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ktomk/pipelines </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../index.html class=md-tabs__link> Read Me </a> </li> <li class=md-tabs__item> <a href=../GETTING-STARTED.html class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../PIPELINES-OFFLINE.html class="md-tabs__link md-tabs__link--active"> Docs </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../index.html title="Pipelines - Run Bitbucket Pipelines Wherever They Dock" class="md-nav__button md-logo" aria-label="Pipelines - Run Bitbucket Pipelines Wherever They Dock" data-md-component=logo> <img src=../../assets/logo.svg alt=logo> </a> Pipelines - Run Bitbucket Pipelines Wherever They Dock </label> <div class=md-nav__source> <a href=https://github.com/ktomk/pipelines/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ktomk/pipelines </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Read Me <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Read Me" data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Read Me </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../index.html class=md-nav__link> Pipelines </a> </li> <li class=md-nav__item> <a href=../../CHANGELOG.html class=md-nav__link> Change Log </a> </li> <li class=md-nav__item> <a href=../../COPYING.html class=md-nav__link> Copying </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../GETTING-STARTED.html class=md-nav__link> Getting Started </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Docs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docs data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../PIPELINES-OFFLINE.html class=md-nav__link> Working Offline </a> </li> <li class=md-nav__item> <a href=../PIPELINES-CACHES.html class=md-nav__link> Working with Pipeline Caches </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Working with Pipeline Services <span class="md-nav__icon md-icon"></span> </label> <a href=../PIPELINES-SERVICES.html class="md-nav__link md-nav__link--active"> Working with Pipeline Services </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction-to-services-in-pipelines class=md-nav__link> Introduction to Services in Pipelines </a> </li> <li class=md-nav__item> <a href=#service-example class=md-nav__link> Service Example </a> <nav class=md-nav aria-label="Service Example"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#defining-a-service class=md-nav__link> Defining a Service </a> </li> <li class=md-nav__item> <a href=#use-a-service-in-a-pipeline-step class=md-nav__link> Use a Service in a Pipeline Step </a> </li> <li class=md-nav__item> <a href=#run-the-pipeline-with-the-example-redis-service class=md-nav__link> Run the Pipeline with the Example Redis Service </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#validate-pipeline-services class=md-nav__link> Validate Pipeline Services </a> </li> <li class=md-nav__item> <a href=#trouble-shoot-starting-service-containers class=md-nav__link> Trouble-Shoot Starting Service Containers </a> <nav class=md-nav aria-label="Trouble-Shoot Starting Service Containers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the---service-service-option class=md-nav__link> The --service &lt;service&gt; option </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#debug-pipeline-services class=md-nav__link> Debug Pipeline Services </a> <nav class=md-nav aria-label="Debug Pipeline Services"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#keep-service-containers-with---keep class=md-nav__link> Keep Service Containers with --keep </a> </li> <li class=md-nav__item> <a href=#inspect-kept-containers-with-docker class=md-nav__link> Inspect Kept Containers with Docker </a> </li> <li class=md-nav__item> <a href=#clean-with---docker-zap class=md-nav__link> Clean with --docker-zap </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Reference data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../PIPELINES-VARIABLE-REFERENCE.html class=md-nav__link> Pipelines Environment Variable Usage </a> </li> <li class=md-nav__item> <a href=../CONFIGURATION-PARAMETERS.html class=md-nav__link> Configuration Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5> How-To <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=How-To data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> How-To </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../PIPELINES-HOWTO-DOCKER-CLIENT-BINARY.html class=md-nav__link> Docker Client Binary Packages for Pipelines </a> </li> <li class=md-nav__item> <a href=../PIPELINES-HOWTO-ROOTLESS.html class=md-nav__link> Rootless Pipelines </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6 type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6> Appendix <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Appendix data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Appendix </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../DEVELOPMENT.html class=md-nav__link> Utility Development </a> </li> <li class=md-nav__item> <a href=../../lib/build/mkdocs.html class=md-nav__link> HTML Documentation Build </a> </li> <li class=md-nav__item> <a href=../DOCKER-NAME-TAG.html class=md-nav__link> Docker Container (Image/Tag) Name Syntax </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction-to-services-in-pipelines class=md-nav__link> Introduction to Services in Pipelines </a> </li> <li class=md-nav__item> <a href=#service-example class=md-nav__link> Service Example </a> <nav class=md-nav aria-label="Service Example"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#defining-a-service class=md-nav__link> Defining a Service </a> </li> <li class=md-nav__item> <a href=#use-a-service-in-a-pipeline-step class=md-nav__link> Use a Service in a Pipeline Step </a> </li> <li class=md-nav__item> <a href=#run-the-pipeline-with-the-example-redis-service class=md-nav__link> Run the Pipeline with the Example Redis Service </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#validate-pipeline-services class=md-nav__link> Validate Pipeline Services </a> </li> <li class=md-nav__item> <a href=#trouble-shoot-starting-service-containers class=md-nav__link> Trouble-Shoot Starting Service Containers </a> <nav class=md-nav aria-label="Trouble-Shoot Starting Service Containers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the---service-service-option class=md-nav__link> The --service &lt;service&gt; option </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#debug-pipeline-services class=md-nav__link> Debug Pipeline Services </a> <nav class=md-nav aria-label="Debug Pipeline Services"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#keep-service-containers-with---keep class=md-nav__link> Keep Service Containers with --keep </a> </li> <li class=md-nav__item> <a href=#inspect-kept-containers-with-docker class=md-nav__link> Inspect Kept Containers with Docker </a> </li> <li class=md-nav__item> <a href=#clean-with---docker-zap class=md-nav__link> Clean with --docker-zap </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ktomk/pipelines/edit/master/doc/PIPELINES-SERVICES.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=working-with-pipeline-services>Working with Pipeline Services<a class=headerlink href=#working-with-pipeline-services title="Permanent link">&para;</a></h1> <p>The <code>pipelines</code> local runner supports services since version 0.0.37 (the special <code>docker</code> service from version 0.0.25 is not covered by this document, see <a href=../..#pipelines-inside-pipeline><em>Pipelines inside Pipeline</em></a>).</p> <p><a href=#introduction-to-services-in-pipelines>Introduction</a> | <a href=#service-example>Example</a> | <a href=#validate-pipeline-services>Validate</a> | <a href=#trouble-shoot-starting-service-containers>Trouble-Shoot</a> | <a href=#debug-pipeline-services>Debug</a></p> <h2 id=introduction-to-services-in-pipelines>Introduction to Services in Pipelines<a class=headerlink href=#introduction-to-services-in-pipelines title="Permanent link">&para;</a></h2> <p>A service is another container that is started before the step script using <a href=https://docs.docker.com/network/host/ >host networking</a> both for the service as well as for the pipeline step container.</p> <p>The step script can then access on <code>localhost</code> the started service.</p> <p>After the step script is run (and any optional <code>after-script</code>), the step container is shut down and removed; afterwards any service containers are shut down and removed.</p> <p>Services are defined in the <code>bitbucket-pipelines.yml</code> file and then referenced by a pipeline step.</p> <p>Next to running bitbucket pipelines locally with services, the <code>pipelines</code> runner has options for <a href=#validate-pipeline-services>validating</a>, <a href=#trouble-shoot-starting-service-containers>trouble-shooting</a> and <a href=#debug-pipeline-services>debugging services</a>.</p> <h2 id=service-example>Service Example<a class=headerlink href=#service-example title="Permanent link">&para;</a></h2> <p>Here a simple service example with a <code>redis</code> service in a step script that pings it.</p> <h3 id=defining-a-service>Defining a Service<a class=headerlink href=#defining-a-service title="Permanent link">&para;</a></h3> <p>A service definition in <code>bitbucket-pipelines.yml</code> is required to make use of the service in a pipeline step:</p> <p></p><div class=highlight><pre><span></span><code><span class=nt>definitions</span><span class=p>:</span>
  <span class=nt>services</span><span class=p>:</span>
    <span class=nt>redis</span><span class=p>:</span>
      <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">redis:6.0.4-alpine</span>
</code></pre></div> <em>Pipelines YAML fragment:</em> Definition of the <code>redis</code> service <p>The service named <code>redis</code> is then defined and ready to use by the step <code>services</code>.</p> <h3 id=use-a-service-in-a-pipeline-step>Use a Service in a Pipeline Step<a class=headerlink href=#use-a-service-in-a-pipeline-step title="Permanent link">&para;</a></h3> <p>As now defined, the step is ready to use by the steps' <code>services</code> list by referencing the defined service <em>name</em>, here <code>redis</code>.</p> <p>A <em>default</em> pipeline named <em>redis service example</em> as an example:</p> <p></p><div class=highlight><pre><span></span><code><span class=nt>pipelines</span><span class=p>:</span>
  <span class=nt>default</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>step</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">redis service example</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">redis:alpine</span>
        <span class=nt>script</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">redis-cli -h localhost ping</span>
        <span class=nt>services</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">redis</span>
</code></pre></div> <em>Pipelines YAML fragment:</em> Default pipeline step with the <code>redis</code> service <p>Note the <code>services</code> list at the very end, it has the <code>redis</code> entry. This tells <code>pipelines</code> to start it for the step.</p> <h3 id=run-the-pipeline-with-the-example-redis-service>Run the Pipeline with the Example Redis Service<a class=headerlink href=#run-the-pipeline-with-the-example-redis-service title="Permanent link">&para;</a></h3> <p>That is it for the configuration, let us run it:</p> <p></p><div class=highlight><pre><span></span><code>$ pipelines
+++ step #1

    name...........: "redis service example"
    effective-image: redis:alpine
    container......: pipelines-1.redis-service-example.default.pipelines
    container-id...: 1fd11cdf4291

+++ copying files into container...


+ redis-cli -h localhost ping
PONG
</code></pre></div> <em>Command line example:</em> Running the default pipeline with the <code>redis</code> service successfully pinging the service. <h2 id=validate-pipeline-services>Validate Pipeline Services<a class=headerlink href=#validate-pipeline-services title="Permanent link">&para;</a></h2> <p>To verify the services are defined and properly wired to pipeline steps, use the <code>--show-services</code> switch, it specifically shows the services by step and checks if services are defined:</p> <p></p><div class=highlight><pre><span></span><code>$ pipelines --show-services
PIPELINE ID    STEP    SERVICE    IMAGE
default        1       redis      redis:6.0.4-alpine
</code></pre></div> <em>Command line example:</em> Default pipeline first step uses the <code>redis</code> service defined with the <em><code>redis:6.0.4-alpine</code></em> image. <p>In case of an error, e.g. the service definition is missing or variables are not well-defined, this would be shown:</p> <p></p><div class=highlight><pre><span></span><code>PIPELINE ID    STEP    SERVICE    IMAGE
default        1       ERROR      Undefined service: "redis"
</code></pre></div> <div class=highlight><pre><span></span><code>PIPELINE ID    STEP    SERVICE    IMAGE
                       ERROR      variable MYSQL_RANDOM_ROOT_PASSWORD \
                                  should be a string (it is currently \
                                  defined as a boolean)
</code></pre></div> <em>Command line examples:</em> Services validation errors with <code>--show-services</code> <p>The <code>--show-services</code> option exits with zero status or non-zero in case an error was found.</p> <p>Part of this service information is also available with the <code>--show</code> command, errors in the file are highlighted more prominently thought:</p> <p></p><div class=highlight><pre><span></span><code>$ pipelines --show
pipelines: file parse error: variable MYSQL_RANDOM_ROOT_PASSWORD \
should be a string (it is currently defined as a boolean)
</code></pre></div> <em>Command line example:</em> Bogus variable with <code>--show</code> <p>Without any errors the <code>--show</code> option displays the information and exits:</p> <p></p><div class=highlight><pre><span></span><code>$ pipelines --show
PIPELINE ID    STEP    IMAGE                 NAME
default        1       redis:alpine          "redis service example"
default        1       redis:6.0.4-alpine    service:redis
</code></pre></div> <em>Command line example:</em> Pipelines shows services for each pipeline step <h2 id=trouble-shoot-starting-service-containers>Trouble-Shoot Starting Service Containers<a class=headerlink href=#trouble-shoot-starting-service-containers title="Permanent link">&para;</a></h2> <p>Sometimes service containers do not start properly, the service container exits prematurely or other unintended things are happening setting up a service.</p> <p>It is possible to start a pipelines service container manually to review the start sequence.</p> <h3 id=the---service-service-option>The <code>--service &lt;service&gt;</code> option<a class=headerlink href=#the---service-service-option title="Permanent link">&para;</a></h3> <p>To start any defined service use the <code>--service</code> option with the name of the service in the <code>definitions</code> section.</p> <p></p><div class=highlight><pre><span></span><code>$ pipelines --service mysql
error: database is uninitialized and password option is not specified
  You need to specify one of MYSQL_ROOT_PASSWORD, \
  MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD
</code></pre></div> <em>Command-line example:</em> Missing variable for pipelines <code>mysql</code> service <p>Fixing the service definition (here by adding a variable to it) and running the <code>pipelines --service mysql</code> again, will show the service properly running by displaying the output of the service.</p> <p>Press <kbd>ctrl</kbd> + <kbd>z</kbd> to suspend the process and either <code>$ bg</code> to send the service in the background or <code>$ kill %</code> which will shut down the service container.</p> <blockquote> <p><strong>Note:</strong> If the <code>--keep</code> or <code>--error-keep</code> option has been used to run the pipeline and the service exited in error, the stopped service container needs to be removed before <code>--service</code> can successfully run the service:</p> <div class=highlight><pre><span></span><code>$ docker rm pipelines-service-mysql.pipelines
pipelines-service-mysql.pipelines
</code></pre></div> </blockquote> <h2 id=debug-pipeline-services>Debug Pipeline Services<a class=headerlink href=#debug-pipeline-services title="Permanent link">&para;</a></h2> <p>As the <code>pipelines</code> utility is designed to run bitbucket pipelines locally, trouble-shooting and debugging pipeline services is easily possible and supported with various options re-iterating quickly locally.</p> <h3 id=keep-service-containers-with---keep>Keep Service Containers with <code>--keep</code><a class=headerlink href=#keep-service-containers-with---keep title="Permanent link">&para;</a></h3> <p>To leave service containers on the system for inspection and re- iteration, use the <code>--keep</code> (or <code>--error-keep</code>) option. The step container and all service containers are then kept and not removed:</p> <p></p><div class=highlight><pre><span></span><code>$ pipelines --keep
+++ step #1

    name...........: "redis service example"
    effective-image: redis:alpine
[...]
+ redis-cli -h localhost ping
PONG
keeping container id 0aa93bcf3b7b
keeping service container pipelines-service-redis.pipelines
</code></pre></div> <em>Command line example:</em> Keeping service containers for inspection <h3 id=inspect-kept-containers-with-docker>Inspect Kept Containers with Docker<a class=headerlink href=#inspect-kept-containers-with-docker title="Permanent link">&para;</a></h3> <p>With the containers still running, service configuration problems can be reviewed, e.g. in case a service didn't start well. For example by inspecting the logs:</p> <p></p><div class=highlight><pre><span></span><code>$ docker logs pipelines-service-redis.pipelines
1:C 01 Jun 2020 08:42:42.739 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
1:C 01 Jun 2020 08:42:42.739 # Redis version=6.0.4, bits=64, commit=00000000, modified=0, pid=1, just started
1:C 01 Jun 2020 08:42:42.739 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
1:M 01 Jun 2020 08:42:42.740 * Running mode=standalone, port=6379.
1:M 01 Jun 2020 08:42:42.740 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
1:M 01 Jun 2020 08:42:42.740 # Server initialized
1:M 01 Jun 2020 08:42:42.740 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.
1:M 01 Jun 2020 08:42:42.740 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.
1:M 01 Jun 2020 08:42:42.740 * Ready to accept connections
</code></pre></div> <em>Command line example:</em> Reviewing logs of a pipeline service <h3 id=clean-with---docker-zap>Clean with <code>--docker-zap</code><a class=headerlink href=#clean-with---docker-zap title="Permanent link">&para;</a></h3> <p>Running the pipeline again will re-use the existing step and service containers for a fast re-iteration. In case this is unwanted and a fresh run is preferred, just "zap" all kept pipeline containers:</p> <p></p><div class=highlight><pre><span></span><code>$ pipelines --docker-zap
</code></pre></div> <em>Command line example:</em> Remove all pipeline containers incl. service containers <p>Afterwards <em>all</em> pipelines containers are gone and will be re-created on next pipelines run.</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../PIPELINES-CACHES.html class="md-footer__link md-footer__link--prev" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Working with Pipeline Caches </div> </div> </a> <a href=../PIPELINES-VARIABLE-REFERENCE.html class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Pipelines Environment Variable Usage </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made by <a href=https://ktomk.github.io/ title="Ktomk home on Github Pages"> Ktomk on Github.io </a> </div> <div class=md-social> <a href=https:/ktomk.github.io/pipelines/index.html target=_blank rel=noopener title="Pipelines homepage" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 96 96"> <path d="m 48.001503,8 c -3.067868,0 -6.135869,1.17553 -8.486698,3.52617 L 11.526141,39.51326 c -4.7015212,4.70127 -4.7015212,12.27021 0,16.97135 l 17.024333,17.02351 9.563268,-29.42914 a 6.6334399,6.6329078 0 0 1 0.151061,-0.49991 6.6334399,6.6329078 0 0 1 0.169254,-0.48603 L 49.792552,8.13582 C 49.199219,8.04692 48.600226,8 48.001503,8 Z m 13.110599,8.14969 -5.941417,18.28527 h 24.228283 z m -9.951098,31.52579 a 6.6334399,6.6329078 0 0 1 -0.284874,0.0135 6.6334399,6.6329078 0 0 1 -0.169255,0.4847 l -11.647547,35.84504 0.455477,0.45544 c 4.701656,4.70116 12.271874,4.70116 16.973395,0 L 84.477538,56.48694 c 2.433434,-2.43311 3.60366,-5.63438 3.518089,-8.80901 z"/> </svg> </a> <a href=https://github.com/ktomk/pipelines target=_blank rel=noopener title="Pipelines utility Github repository" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://hub.docker.com/r/ktomk/pipelines target=_blank rel=noopener title="Pipelines test container images on Docker Hub" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href=https://ktomk.github.io/ target=_blank rel=noopener title=ktomk.github.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"/></svg> </a> <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener title="Made with Material for MkDocs + Mkdocs + Makefile + <3" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["tabs", "navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.01824240.min.js"}</script> <script src=../../assets/javascripts/iframe-worker-0.2.0.js></script> <script src=../../search/search_index.js></script> <script src=../../assets/javascripts/bundle.e0abf5b0.min.js></script> </body> </html>
